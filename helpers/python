# -*- python -*-

import pkgutil
import sys


class PackageNotFoundError(Exception):
    def __init__(self, name):
        Exception.__init__(self, name)
        self.name = name


try:
    from importlib import import_module
except ImportError:

    def import_module(name):
        __import__(name)
        return sys.modules[name]


def print_error(message):
    sys.stderr.write("error: %s\n" % message)


def import_package(pkgname):
    parentname = pkgname.rpartition(".")[0]
    if parentname:
        parent = import_package(parentname)
        path = parent.__path__
        prefix = parentname + "."
    else:
        path = sys.path
        prefix = ""
    for _, name, ispkg in pkgutil.iter_modules(path, prefix=prefix):
        if ispkg and name == pkgname:
            return import_module(pkgname)
    raise PackageNotFoundError(pkgname)


def walk_subpackages(pkgname):
    try:
        pkg = import_package(pkgname)
    except PackageNotFoundError:
        pkgname = sys.exc_info()[1].name
        print_error("package not found: %s" % pkgname)
        return []
    return pkgutil.walk_packages(
        pkg.__path__, pkgname + ".", onerror=lambda _: None
    )


if len(sys.argv) > 1 and "." in sys.argv[1]:
    pkgname = sys.argv[1].rpartition(".")[0]
    modules = walk_subpackages(pkgname)
else:
    modules = pkgutil.iter_modules()

for mod in modules:
    print(mod[1])  # noqa: E211
